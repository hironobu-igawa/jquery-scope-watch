/*!
 * jquery-scope-watch v0.0.0 - Watch the value, and to applied.
 * Copyright 2015 hironobu-igawa
 * license MIT
 */
var scope;!function(e){var t=function(){function e(e,t){this.valueGetter=e,this.apply=t}return e.copy=function(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e)){var t=[];for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n},e.prototype.call=function(){var t=this.valueGetter();this.oldValue=this.newValue,this.newValue=e.copy(this.valueGetter()),this.isChange()&&this.apply(t,this.oldValue)},e.prototype.isChange=function(){var e=this;return null==this.newValue||null==this.oldValue?this.newValue!=this.oldValue:"object"!=typeof this.newValue||"object"!=typeof this.oldValue?this.newValue!==this.oldValue:Object.keys(this.newValue).concat(Object.keys(this.oldValue)).some(function(t){return e.newValue[t]!==e.oldValue[t]})},e}();e.CollectionWatcher=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(e,t){this.valueGetter=e,this.apply=t}return e.prototype.call=function(){this.oldValue=this.newValue,this.newValue=this.valueGetter(),this.apply&&this.isChange()&&this.apply(this.newValue,this.oldValue)},e.prototype.isChange=function(){return this.newValue!==this.oldValue},e}();e.Watcher=t}(scope||(scope={}));var scope;!function(e){var t=function(){function t(){this.parent=void 0,this.children=[],this.watchers=[],this.listeners={},this.destroyed=!1}return t.generate=function(){return t.root.generate()},t.apply=function(){t.root.apply()},t.prototype.generate=function(){var e=Object.create(this);return e.parent=this,e.children=[],e.watchers=[],e.listeners=[],e.destroyed=!1,this.children.push(e),e},t.prototype.watch=function(t,r){var n=this,o=new e.Watcher(this.generateValueGetter(t),r);return this.watchers.push(o),function(){n.watchers.splice(n.watchers.indexOf(o),1)}},t.prototype.watchCollection=function(t,r){var n=this,o=new e.CollectionWatcher(this.generateValueGetter(t),r);return this.watchers.push(o),function(){n.watchers.splice(n.watchers.indexOf(o),1)}},t.prototype.apply=function(){this.destroyed||(this.watchers.forEach(function(e){return e.call()}),this.children.forEach(function(e){return e.apply()}))},t.prototype.on=function(e,t){var r=this;return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),function(){var n=r.listeners[e].indexOf(t);-1!==n&&r.listeners[e].splice(r.listeners[e].indexOf(t),1)}},t.prototype.broadcast=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.destroyed||(this.listeners[e]&&this.listeners[e].forEach(function(e){return e.apply(null,t)}),this.children.forEach(function(r){return r.broadcast(e,t)}))},t.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.destroyed||(this.listeners[e]&&this.listeners[e].forEach(function(e){return e.apply(null,t)}),this.parent.emit(e,t))},t.prototype.destroy=function(){if(!this.destroyed){var e=function(t){$.extend([],this.children).forEach(function(t){return e(t)}),t.destroyed=!0,t.parent&&t.parent.children.splice(t.parent.children.indexOf(t),1),t.parent=null,t.children=null,t.watchers=null,t.listeners=null};this.broadcast("destroy"),e(this),this===t.root&&(t._root=void 0)}},t.prototype.bind=function(t,r){e.BindWorker.apply(this,t,$(r))},t.prototype.show=function(t,r){e.ShowWorker.apply(this,t,$(r))},t.prototype.hide=function(t,r){e.HideWorker.apply(this,t,$(r))},t.prototype.repeat=function(t,r,n,o){return e.RepeatWorker.generate(this,t,r,n,o)},t.prototype.generateValueGetter=function(t){switch(typeof t){case"string":return e.Parser.generate(t).bind(null,this);case"function":return t;default:return function(){return t}}},Object.defineProperty(t,"root",{get:function(){return t._root||(t._root=new t)},enumerable:!0,configurable:!0}),t}();e.Scope=t}(scope||(scope={}));var scope;!function(e){$.scope=e.Scope}(scope||(scope={}));var scope;!function(scope_2){var Parser=function(){function Parser(){}return Parser.generate=function(_expression){var expression=Parser.compile(_expression);return function(scope){try{eval("var "+Parser.SCOPE+" = scope");var result=eval(expression);return console.log([expression,scope,result]),eval(expression)}catch(e){return void console.log([expression,scope,void 0])}}},Parser.compile=function(e){return e.replace(/[a-zA-Z$_][a-zA-Z$_0-9\.]*/g,function(e){return Parser.SCOPE+"."+e})},Parser.SCOPE="scope",Parser}();scope_2.Parser=Parser}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,r){e.watch(t,function(e){return r.text(e||"")})},e}();e.BindWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,r){e.watch(t,function(e){return e?r.hide():r.show()})},e}();e.HideWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(e,t,n,o,i){var s=this;this.scope=e,this.expression=t,this.valueKey=n,this.rowGenerator=o,this.primaryKey=i,this.keys=[],this.rowMap=new r,this.startComment=document.createComment("start repeater"),this.endComment=document.createComment("end repeater"),e.on("destroy",function(){return s.rowMap.values.forEach(function(e){return e.elem.remove()})}),e.watchCollection(t,this.render.bind(this))}return e.generate=function(t,r,n,o,i){var s=new e(t,r,n,o,i);return $([s.startComment,s.endComment])},e.prototype.render=function(e){var t=this,r=this.getCollection(e);r.forEach(function(e,r){var n=t.rowMap.get(e.key);if(n||t.rowMap.put(e.key,n=t.generateRow(e.value)),n.scope[t.valueKey]=e.value,e.key!==t.keys[r]){var o=r?t.rowMap.get(t.keys[r-1]).elem:$(t.startComment);o.after(n.elem);var i=t.keys.indexOf(e.key);i>-1&&t.keys.splice(i,1),t.keys.splice(r,0,e.key)}});for(var n=r.length;n<this.keys.length;n++)this.destroyRow(this.keys[n]);this.keys.length=r.length},e.prototype.destroyRow=function(e){var t=this.rowMap.get(e);t&&(t.scope.destroy(),t.elem.remove(),delete this.rowMap.remove(e))},e.prototype.generateRow=function(e){var t=this.scope.generate();t[this.valueKey]=e;var r=this.rowGenerator(t);return{elem:r,scope:t}},e.prototype.getCollection=function(e){var t=this,r=e instanceof Array?e.map(function(e,t){return t}):e?Object.keys(e).filter(function(t){return e.hasOwnProperty(t)}):[];return r.map(function(r){return{key:t.primaryKey?e[r][t.primaryKey]:e[r],value:e[r]}})},e}();e.RepeatWorker=t;var r=function(){function e(){this._values=[]}return e.prototype.put=function(e,t){return this.remove(e),this._values.push({key:e,row:t}),this},e.prototype.remove=function(e){var t=this._values.map(function(e){return e.key}).indexOf(e);return-1===t?this:(this._values.splice(t,1),this)},e.prototype.get=function(e){var t=this._values.map(function(e){return e.key}).indexOf(e);return t>-1?this._values[t].row:null},Object.defineProperty(e.prototype,"values",{get:function(){return this._values.map(function(e){return e.row})},enumerable:!0,configurable:!0}),e}()}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,r){e.watch(t,function(e){return e?r.show():r.hide()})},e}();e.ShowWorker=t}(scope||(scope={}));