/*!
 * jquery-scope-watch v0.0.0 - Watch the value, and to applied.
 * Copyright 2015 hironobu-igawa
 * license MIT
 */
var scope;!function(e){var t=function(){function e(e,t){this.valueGetter=e,this.apply=t}return e.copy=function(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e)){var t=[];for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n},e.prototype.call=function(){var t=this.valueGetter();this.oldValue=this.newValue,this.newValue=e.copy(this.valueGetter()),this.isChange()&&this.apply(t,this.oldValue)},e.prototype.isChange=function(){var e=this;return null==this.newValue||null==this.oldValue?this.newValue!=this.oldValue:"object"!=typeof this.newValue||"object"!=typeof this.oldValue?this.newValue!==this.oldValue:Object.keys(this.newValue).concat(Object.keys(this.oldValue)).some(function(t){return e.newValue[t]!==e.oldValue[t]})},e}();e.CollectionWatcher=t}(scope||(scope={}));var scope;!function(e){var t=function(){function t(){this.parent=void 0,this.children=[],this.watchers=[],this.listeners={},this.destroyed=!1}return t.generate=function(){return t.root.generate()},t.watch=function(e,r){return t.root.watch(e,r)},t.watchCollection=function(e,r){return t.root.watchCollection(e,r)},t.apply=function(){t.root.apply()},t.on=function(e,r){return t.root.on(e,r)},t.broadcast=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=[e];r.forEach(function(e){return o.push(e)}),t.root.broadcast.apply(t.root,r)},t.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=[e];r.forEach(function(e){return o.push(e)}),t.root.emit.apply(t.root,r)},t.destroy=function(){t.root.destroy()},t.prototype.generate=function(){var e=Object.create(this);return e.parent=this,e.children=[],e.watchers=[],e.listeners=[],e.destroyed=!1,this.children.push(e),e},t.prototype.watch=function(t,r){var n,o=this;switch(typeof t){case"string":n=function(){return o.parse(t)};break;case"function":n=t;break;default:n=function(){return t}}var i=new e.Watcher(n,r);return this.watchers.push(i),function(){o.watchers.splice(o.watchers.indexOf(i),1)}},t.prototype.watchCollection=function(t,r){var n,o=this;switch(typeof t){case"string":n=function(){return o.parse(t)};break;case"function":n=t;break;default:n=function(){return t}}var i=new e.CollectionWatcher(n,r);return this.watchers.push(i),function(){o.watchers.splice(o.watchers.indexOf(i),1)}},t.prototype.apply=function(){this.destroyed||(this.watchers.forEach(function(e){return e.call()}),this.children.forEach(function(e){return e.apply()}))},t.prototype.on=function(e,t){var r=this;return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),function(){var n=r.listeners[e].indexOf(t);-1!==n&&r.listeners[e].splice(r.listeners[e].indexOf(t),1)}},t.prototype.broadcast=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.destroyed||(this.listeners[e]&&this.listeners[e].forEach(function(e){return e.apply(null,t)}),this.children.forEach(function(r){return r.broadcast(e,t)}))},t.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.destroyed||(this.listeners[e]&&this.listeners[e].forEach(function(e){return e.apply(null,t)}),this.parent.emit(e,t))},t.prototype.destroy=function(){if(!this.destroyed){var e=function(t){$.extend([],this.children).forEach(function(t){return e(t)}),t.destroyed=!0,t.parent&&t.parent.children.splice(t.parent.children.indexOf(t),1),t.parent=null,t.children=null,t.watchers=null,t.listeners=null};this.broadcast("destroy"),e(this),this===t.root&&(t._root=void 0)}},t.prototype.repeat=function(t,r,n,o){return e.Repeater.generate(this,t,r,n,o)},t.prototype.parse=function(e){return e.split(".").reduce(function(e,t){return e&&e[t]},this)},Object.defineProperty(t,"root",{get:function(){return t._root||(t._root=new t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return t.root},enumerable:!0,configurable:!0}),t}();e.Scope=t}(scope||(scope={}));var scope;!function(e){$.scope=e.Scope}(scope||(scope={}));var scope;!function(e){var t=function(){function e(e,t,r,n,o){var i=this;this.scope=e,this.expression=t,this.valueKey=r,this.rowGenerator=n,this.primaryKey=o,this.keys=[],this.rowMap={},this.startComment=document.createComment("start repeater"),this.endComment=document.createComment("end repeater"),e.on("destroy",function(){return $.each(i.rowMap,function(e,t){return t.elem.remove()})}),e.watchCollection(t,this.render.bind(this))}return e.generate=function(t,r,n,o,i){var s=new e(t,r,n,o,i);return $([s.startComment,s.endComment])},e.prototype.render=function(e){var t=this,r=this.getCollection(e);r.forEach(function(e,r){var n=t.rowMap[e.key]=t.rowMap[e.key]||t.generateRow(e.value);if(n.scope[t.valueKey]=e.value,e.key!==t.keys[r]){var o=r?t.rowMap[t.keys[r-1]].elem:$(t.startComment);o.after(n.elem);var i=t.keys.indexOf(e.key);i>-1&&t.keys.splice(i,1),t.keys.splice(r,0,e.key)}});for(var n=r.length;n<this.keys.length;n++)this.destroyRow(this.keys[n]);this.keys.length=r.length},e.prototype.destroyRow=function(e){var t=this.rowMap[e];t&&(t.scope.destroy(),t.elem.remove(),delete this.rowMap[e])},e.prototype.generateRow=function(e){var t=this.scope.generate();t[this.valueKey]=e;var r=this.rowGenerator(t);return{elem:r,scope:t}},e.prototype.getCollection=function(e){var t=this,r=e instanceof Array?e.map(function(e,t){return t}):e?Object.keys(e).filter(function(t){return e.hasOwnProperty(t)}):[];return r.map(function(r){return{key:t.primaryKey?e[r][t.primaryKey]:r,value:e[r]}})},e}();e.Repeater=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(e,t){this.valueGetter=e,this.apply=t}return e.prototype.call=function(){this.oldValue=this.newValue,this.newValue=this.valueGetter(),this.apply&&this.isChange()&&this.apply(this.newValue,this.oldValue)},e.prototype.isChange=function(){return this.newValue!==this.oldValue},e}();e.Watcher=t}(scope||(scope={}));