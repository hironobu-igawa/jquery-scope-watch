/*!
 * jquery-scope-watch v0.1.2 - Watch the value, and to applied.
 * Copyright 2015 hironobu-igawa
 * license MIT
 */
var scope;!function(e){var t=function(){function t(){this.parent=void 0,this.children=[],this.watchers=[],this.listeners={},this.destroyed=!1}return t.generate=function(){return t.root.generate()},t.apply=function(){t.root.apply()},t.prototype.generate=function(){var e=Object.create(this);return e.parent=this,e.children=[],e.watchers=[],e.listeners=[],e.destroyed=!1,this.children.push(e),e},t.prototype.watch=function(t,n){var r=this,o=new e.Watcher(this.generateValueGetter(t),n);return this.watchers.push(o),function(){r.watchers.splice(r.watchers.indexOf(o),1)}},t.prototype.watchCollection=function(t,n){var r=this,o=new e.CollectionWatcher(this.generateValueGetter(t),n);return this.watchers.push(o),function(){r.watchers.splice(r.watchers.indexOf(o),1)}},t.prototype.apply=function(){this.destroyed||(this.watchers.forEach(function(e){return e.call()}),this.children.forEach(function(e){return e.apply()}))},t.prototype.on=function(e,t){var n=this;return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),function(){var r=n.listeners[e].indexOf(t);-1!==r&&n.listeners[e].splice(n.listeners[e].indexOf(t),1)}},t.prototype.broadcast=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.destroyed||(this.listeners[e]&&this.listeners[e].forEach(function(e){return e.apply(null,t)}),this.children.forEach(function(n){return n.broadcast(e,t)}))},t.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.destroyed||(this.listeners[e]&&this.listeners[e].forEach(function(e){return e.apply(null,t)}),this.parent.emit(e,t))},t.prototype.destroy=function(){if(!this.destroyed){var e=function(t){$.extend([],this.children).forEach(function(t){return e(t)}),t.destroyed=!0,t.parent&&t.parent.children.splice(t.parent.children.indexOf(t),1),t.parent=null,t.children=null,t.watchers=null,t.listeners=null};this.broadcast("destroy"),e(this),this===t.root&&(t._root=void 0)}},t.prototype.bind=function(t,n){e.BindWorker.apply(this,t,$(n))},t.prototype.show=function(t,n){e.ShowWorker.apply(this,t,$(n))},t.prototype.hide=function(t,n){e.HideWorker.apply(this,t,$(n))},t.prototype.klass=function(t,n,r){e.KlassWorker.apply(this,t,$(n),r)},t.prototype.attr=function(t,n,r){e.AttrWorker.apply(this,t,$(n),r)},t.prototype.click=function(t,n){e.ClickWorker.apply(this,$(t),n)},t.prototype.input=function(t,n){return e.InputWorker.generate(this,t,$(n))},t.prototype.select=function(t,n,r,o,i){return e.SelectWorker.generate(this,t,$(n),r,o,i)},t.prototype.submit=function(t,n){e.SubmitWorker.apply(this,$(t),n)},t.prototype.repeat=function(t,n,r,o){return e.RepeatWorker.generate(this,t,n,r,o)},t.prototype.generateValueGetter=function(t){switch(typeof t){case"string":return e.Parser.generate(t).bind(null,this);case"function":return t;default:return function(){return t}}},Object.defineProperty(t,"root",{get:function(){return t._root||(t._root=new t)},enumerable:!0,configurable:!0}),t}();e.Scope=t}(scope||(scope={}));var scope;!function(e){$.scope=e.Scope}(scope||(scope={}));var scope;!function(scope_2){var Parser=function(){function Parser(){}return Parser.generate=function(_expression){var expression=Parser.compile(_expression),getter=function(scope){try{return eval("var "+Parser.SCOPE+" = scope"),eval(expression)}catch(e){}},setter=function(scope,value){try{return eval("var "+Parser.SCOPE+" = scope"),eval(expression+" = value")}catch(e){}};return $.extend(getter,{assign:setter})},Parser.compile=function(e){return e.replace(/[a-zA-Z$_][a-zA-Z$_0-9\.]*/g,function(e){return Parser.SCOPE+"."+e})},Parser.SCOPE="scope",Parser}();scope_2.Parser=Parser}(scope||(scope={}));var scope;!function(e){var t=function(){function e(e,t){this.valueGetter=e,this.apply=t,this.newValue=NaN,this.oldValue=NaN}return e.copy=function(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e)){var t=[];for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r},e.prototype.call=function(){var t=this.valueGetter();this.oldValue=this.newValue,this.newValue=e.copy(this.valueGetter()),this.isChange()&&this.apply(t,this.oldValue)},e.prototype.isChange=function(){var e=this;return null==this.newValue||null==this.oldValue?this.newValue!=this.oldValue:"object"!=typeof this.newValue||"object"!=typeof this.oldValue?this.newValue!==this.oldValue:Object.keys(this.newValue).concat(Object.keys(this.oldValue)).some(function(t){return e.newValue[t]!==e.oldValue[t]})},e}();e.CollectionWatcher=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(e,t){this.valueGetter=e,this.apply=t,this.newValue=NaN,this.oldValue=NaN}return e.prototype.call=function(){this.oldValue=this.newValue,this.newValue=this.valueGetter(),this.apply&&this.isChange()&&this.apply(this.newValue,this.oldValue)},e.prototype.isChange=function(){return this.newValue!==this.oldValue},e}();e.Watcher=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,n,r){e.watch(t,function(e){return n.attr(r,void 0!==e?e:null)})},e}();e.AttrWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,n){e.watch(t,function(e){return n.text(null!=e?e:"")})},e}();e.BindWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function t(){}return t.apply=function(e,n,r){var o=t.compile(e,r),i=function(e){o(e),$.scope.apply()};n.on("click",i),e.on("destroy",function(){return n.off("click",i)})},t.compile=function(t,n){return"string"==typeof n?e.Parser.generate(n).bind(null,t):n},t}();e.ClickWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,n){e.watch(t,function(e){return e?n.hide():n.show()})},e}();e.HideWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function t(e,t,n){this.scope=e,this.expression=t,this.$input=n,this.callbacks=[]}return t.generate=function(e,n,r){var o=new t(e,n,r);return o.init(),o},t.prototype.change=function(e){this.callbacks.push(this.compile(e))},t.prototype.init=function(){var t=this;this.scope.watch(this.expression,function(e){t.isChanged(e)&&t.$input.val(e)});var n=e.Parser.generate(this.expression).assign,r=function(e){t.isChanged(t.getInputValue())&&(n(t.scope,t.getInputValue()),t.callbacks.forEach(function(t){return t(e)}),$.scope.apply())};this.$input.on("change input",r),this.scope.on("destroy",function(){return t.$input.off("change input",function(){})})},t.prototype.compile=function(t){return"string"==typeof t?e.Parser.generate(t).bind(null,this.scope):t},t.prototype.isChanged=function(e){return this.value===e?!1:(this.value=e,!0)},t.prototype.getInputValue=function(){var e=this.$input.val();return"number"===this.$input.prop("type")?e?Number(e):null:"range"===this.$input.prop("type")?Number(e):e},t}();e.InputWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,n,r){e.watch(t,function(e){return e?n.addClass(r):n.removeClass(r)})},e}();e.KlassWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(e,t,r,o,i){var s=this;this.scope=e,this.expression=t,this.valueKey=r,this.rowGenerator=o,this.primaryKey=i,this.keys=[],this.rowMap=new n,this.startComment=document.createComment("start repeater"),this.endComment=document.createComment("end repeater"),e.on("destroy",function(){return s.rowMap.values.forEach(function(e){return e.elem.remove()})}),e.watchCollection(t,this.render.bind(this))}return e.generate=function(t,n,r,o,i){var s=new e(t,n,r,o,i);return $([s.startComment,s.endComment])},e.prototype.render=function(e){var t=this,n=this.getCollection(e);n.forEach(function(e,n){var r=t.rowMap.get(e.key);if(r||t.rowMap.put(e.key,r=t.generateRow(e.value)),r.scope[t.valueKey]=e.value,e.key!==t.keys[n]){var o=n?t.rowMap.get(t.keys[n-1]).elem:$(t.startComment);o.after(r.elem);var i=t.keys.indexOf(e.key);i>-1&&t.keys.splice(i,1),t.keys.splice(n,0,e.key)}});for(var r=n.length;r<this.keys.length;r++)this.destroyRow(this.keys[r]);this.keys.length=n.length},e.prototype.destroyRow=function(e){var t=this.rowMap.get(e);t&&(t.scope.destroy(),t.elem.remove(),delete this.rowMap.remove(e))},e.prototype.generateRow=function(e){var t=this.scope.generate();t[this.valueKey]=e;var n=this.rowGenerator(t);return{elem:n,scope:t}},e.prototype.getCollection=function(e){var t=this,n=e instanceof Array?e.map(function(e,t){return t}):e?Object.keys(e).filter(function(t){return e.hasOwnProperty(t)}):[];return n.map(function(n){return{key:t.primaryKey?e[n][t.primaryKey]:e[n],value:e[n]}})},e}();e.RepeatWorker=t;var n=function(){function e(){this._values=[]}return e.prototype.put=function(e,t){return this.remove(e),this._values.push({key:e,row:t}),this},e.prototype.remove=function(e){var t=this._values.map(function(e){return e.key}).indexOf(e);return-1===t?this:(this._values.splice(t,1),this)},e.prototype.get=function(e){var t=this._values.map(function(e){return e.key}).indexOf(e);return t>-1?this._values[t].row:null},Object.defineProperty(e.prototype,"values",{get:function(){return this._values.map(function(e){return e.row})},enumerable:!0,configurable:!0}),e}()}(scope||(scope={}));var scope;!function(e){var t=function(){function t(e,t,n,r,o,i){this.scope=e,this.expression=t,this.$select=n,this.dataExpression=r,this.valueKey=o,this.labelKey=i,this.value=NaN,this.callbacks=[]}return t.generate=function(e,n,r,o,i,s){var a=new t(e,n,r,o,i,s);return a.init(),a},t.prototype.change=function(e){this.callbacks.push(this.compile(e))},t.prototype.init=function(){this.render(),this.bind()},t.prototype.render=function(){var e=this;this.scope.repeat(this.dataExpression,"option",function(n){var r=$("<option>").attr({value:null!=e.valueKey?n.option[e.valueKey]:n.option,label:null!=e.labelKey?n.option[e.labelKey]:n.option}),o=e.valueKey?"option."+e.valueKey:"option",i=e.labelKey?"option."+e.labelKey:"option";return n.attr(o,r,"value"),n.attr(i,r,"label"),n.watch(o,function(e){return r.data(t.OPTION_VALUE_KEY,void 0!==e?e:null)}),r},this.valueKey).appendTo(this.$select),this.scope.watch(function(){e.value!==e.getSelectValue()&&e.$select.val(e.value)})},t.prototype.bind=function(){var t=this;this.scope.watch(this.expression,function(e){t.isChanged(e)&&t.$select.val(e)});var n=e.Parser.generate(this.expression).assign,r=function(e){t.isChanged(t.getSelectValue())&&(n(t.scope,t.getSelectValue()),t.callbacks.forEach(function(t){return t(e)}),$.scope.apply())};this.$select.on("change input",r),this.scope.on("destroy",function(){return t.$select.off("change input",function(){})})},t.prototype.compile=function(t){return"string"==typeof t?e.Parser.generate(t).bind(null,this.scope):t},t.prototype.isChanged=function(e){return this.value===e?!1:(this.value=e,!0)},t.prototype.getSelectValue=function(){var e=this.$select.find("option:selected").data(t.OPTION_VALUE_KEY);return void 0===e&&(e=this.$select.val()),e},t.OPTION_VALUE_KEY="_select_option_value",t}();e.SelectWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function e(){}return e.apply=function(e,t,n){e.watch(t,function(e){return e?n.show():n.hide()})},e}();e.ShowWorker=t}(scope||(scope={}));var scope;!function(e){var t=function(){function t(){}return t.apply=function(e,n,r){var o=t.compile(e,r),i=function(e){e.preventDefault(),o(e),$.scope.apply()};n.on("submit",i),e.on("destroy",function(){return n.off("submit",i)})},t.compile=function(t,n){return"string"==typeof n?e.Parser.generate(n).bind(null,t):n},t}();e.SubmitWorker=t}(scope||(scope={}));