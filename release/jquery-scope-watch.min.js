/*!
 * jquery-scope-watch v0.0.0 - Watch the value, and to applied.
 * Copyright 2015 hironobu-igawa
 * license MIT
 */
var scope;!function(t){var e=function(){function t(t,e){this.valueGetter=t,this.apply=e}return t.copy=function(t){if(null==t||"object"!=typeof t)return t;if(Array.isArray(t)){var e=[];for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n},t.prototype.call=function(){var e=this.valueGetter();this.oldValue=this.newValue,this.newValue=t.copy(this.valueGetter()),this.isChange()&&this.apply(e,this.oldValue)},t.prototype.isChange=function(){var t=this;return null==this.newValue||null==this.oldValue?this.newValue!=this.oldValue:"object"!=typeof this.newValue||"object"!=typeof this.oldValue?this.newValue!==this.oldValue:Object.keys(this.newValue).concat(Object.keys(this.oldValue)).some(function(e){return t.newValue[e]!==t.oldValue[e]})},t}();t.CollectionWatcher=e}(scope||(scope={}));var scope;!function(t){var e=function(){function e(){this.parent=void 0,this.children=[],this.watchers=[],this.listeners={},this.destroyed=!1}return e.generate=function(){return e.root.generate()},e.watch=function(t,r){return e.root.watch(t,r)},e.watchCollection=function(t,r){return e.root.watchCollection(t,r)},e.apply=function(){e.root.apply()},e.on=function(t,r){return e.root.on(t,r)},e.broadcast=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=[t];r.forEach(function(t){return o.push(t)}),e.root.broadcast.apply(e.root,r)},e.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=[t];r.forEach(function(t){return o.push(t)}),e.root.emit.apply(e.root,r)},e.destroy=function(){e.root.destroy()},e.prototype.generate=function(){var t=Object.create(this);return t.parent=this,t.children=[],t.watchers=[],t.destroyed=!1,this.children.push(t),t},e.prototype.watch=function(e,r){var n,o=this;switch(typeof e){case"string":n=function(){return o.parse(e)};break;case"function":n=e;break;default:n=function(){return e}}var i=new t.Watcher(n,r);return this.watchers.push(i),function(){o.watchers.splice(o.watchers.indexOf(i),1)}},e.prototype.watchCollection=function(e,r){var n,o=this;switch(typeof e){case"string":n=function(){return o.parse(e)};break;case"function":n=e;break;default:n=function(){return e}}var i=new t.CollectionWatcher(n,r);return this.watchers.push(i),function(){o.watchers.splice(o.watchers.indexOf(i),1)}},e.prototype.apply=function(){this.destroyed||(this.watchers.forEach(function(t){return t.call()}),this.children.forEach(function(t){return t.apply()}))},e.prototype.on=function(t,e){var r=this;return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),function(){var n=r.listeners[t].indexOf(e);-1!==n&&r.listeners[t].splice(r.listeners[t].indexOf(e),1)}},e.prototype.broadcast=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.destroyed||(this.listeners[t].forEach(function(t){return t.apply(null,e)}),this.children.forEach(function(r){return r.broadcast(t,e)}))},e.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.destroyed||(this.listeners[t].forEach(function(t){return t.apply(null,e)}),this.parent.emit(t,e))},e.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,$.extend([],this.children).forEach(function(t){return t.destroy()}),this.broadcast("destroy"),this.parent&&this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent=null,this.children=null,this.watchers=null,this===e.root&&(e._root=void 0))},e.prototype.repeat=function(e,r,n,o){return t.Repeater.generate(this,e,r,n,o)},e.prototype.parse=function(t){return t.split(".").reduce(function(t,e){return t&&t[e]},this)},Object.defineProperty(e,"root",{get:function(){return e._root||(e._root=new e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return e.root},enumerable:!0,configurable:!0}),e}();t.Scope=e}(scope||(scope={}));var scope;!function(t){$.scope=t.Scope}(scope||(scope={}));var scope;!function(t){var e=function(){function t(t,e,r,n,o){var i=this;this.scope=t,this.expression=e,this.valueKey=r,this.rowGenerator=n,this.primaryKey=o,this.keys=[],this.rowMap={},this.startComment=document.createComment("start repeater"),this.endComment=document.createComment("end repeater"),t.on("destroy",function(){return $.each(i.rowMap,function(t,e){e.scope&&e.scope.destroy(),e.elem.remove()})}),t.watchCollection(e,this.render.bind(this))}return t.generate=function(e,r,n,o,i){var s=new t(e,r,n,o,i);return $([s.startComment,s.endComment])},t.prototype.render=function(t){var e=this,r=this.getCollection(t);r.forEach(function(t,r){var n=e.rowMap[t.key]=e.rowMap[t.key]||e.generateRow(t.value);if(n.scope[e.valueKey]=t.value,t.key!==e.keys[r]){var o=r?e.rowMap[e.keys[r-1]].elem:$(e.startComment);o.after(n.elem);var i=e.keys.indexOf(t.key);i>-1&&e.keys.splice(i,1),e.keys.splice(r,0,t.key)}});for(var n=r.length;n<this.keys.length;n++)this.destroyRow(this.keys[n]);this.keys.length=r.length},t.prototype.destroyRow=function(t){var e=this.rowMap[t];e&&(e.scope.destroy(),e.elem.remove(),delete this.rowMap[t])},t.prototype.generateRow=function(t){var e=this.scope.generate();e[this.valueKey]=t;var r=this.rowGenerator(e);return{elem:r,scope:e}},t.prototype.getCollection=function(t){var e=this,r=t instanceof Array?t.map(function(t,e){return e}):t?Object.keys(t).filter(function(e){return t.hasOwnProperty(e)}):[];return r.map(function(r){return{key:e.primaryKey?t[r][e.primaryKey]:r,value:t[r]}})},t}();t.Repeater=e}(scope||(scope={}));var scope;!function(t){var e=function(){function t(t,e){this.valueGetter=t,this.apply=e}return t.prototype.call=function(){this.oldValue=this.newValue,this.newValue=this.valueGetter(),this.apply&&this.isChange()&&this.apply(this.newValue,this.oldValue)},t.prototype.isChange=function(){return this.newValue!==this.oldValue},t}();t.Watcher=e}(scope||(scope={}));